# Transaction Type


### OLTP와 OLAP차이


| 	|OLTP	|OLAP|
|-------|-------|-----|
|원천 데이터|	트랜잭션 단위의 데이터|	트랜잭션 데이터로 집계한 데이터|
|쿼리 사용|	INSERT, UPDATE, DELETE을 주로 사용|	SELECT를 주로 사용|
|목적|	필수적인 비즈니스 운영 관련된 데이터를 실시간으로 관리하기 위함|	계획, 문제 해결, 의사 결정 지원, 인사이트 발견과 같은 분석을 하기 위함|
|데이터 업데이트|	짧고, 빠르게 사용자에 의해 일어남|	주기적으로 batch job, 스케쥴링을 통해 일어남|
|백업과 복구|	정기적인 백업이 요구됨|	손실된 데이터는 정기적으로 백업되는 OLTP 데이터베이스로부터 복구가 가능|
|데이터베이스 디자인|	효율성을 위한 정규화|	데이터 집계와 같은 비정규화|



- 기업의 DB는 크게 운영DB(OLTP, 온라인처리위주시스템)와 분석DB(OLAP, 배치처리위주시스템)로 나뉩니다. 운영DB은 현재의 거래정보를 입력하고 저장하는 용도이며, 분석DB는 운영DB로부터 데이터를 이관 받아 각종 통계를 내고 트렌드를 분석하는데 사용됩니다.

- 금융권에서는 이를 담당하는 시스템을 계정계와 정보계라고 부르기도 합니다. 계정계는 창구∙온라인뱅킹∙ATM 등에서 일어난 거래를 처리하고, 정보계는 계정계 데이터를 끌어와서 각종 마케팅 및 전략 수립 이용할 수 있도록 분석합니다.

- 운영DB와 분석DB로 나누어 관리하는 이유는 하나의 시스템에서 모든 업무를 하는 것이 불가능하기 때문입니다. 하나의 DB에서 트랜잭션 처리와 분석업무를 모두 할 경우 병목현상이 발생해 애플리케이션 속도가 대폭 늦어질 것입니다. 만약 ATM에서 돈을 찾았는데, 두 시간 뒤에 통장에서 돈이 빠져나간 것으로 처리된다면 엄청난 혼란이 일 것입니다.


- 정규화 : 온라인 거래 시스템 같은 OLTP(OnLine Transaction Processing) 데이터베이스는 CRUD(Create, Read, Update, Delete) 가 많이 일어나 정규화가 적절합니다.

- 반정규화 : 분석 리포트 같은 OLAP(OnLine Analytical Processing) 데이터베이스는 분석과 리포팅을 위해 사용되기 때문에 연산의 속도를 위해 반정규화를 사용하는 게 좋습니다.

  - 반정규화란? : 정규화된 시스템을 성능 향상 및 개발과 운영의 단순화를 위해 역으로 정규화를 수행하는 것을 말합니다. 일반적으로 join을 많이 사용해야 할 경우, 대량의 범위를 자주 처리하는 경우 등 조회에 대한 처리가 중요하다고 판단될 때 부분적으로 반정규화를 합니다.

```
- OLTP : 현재 업무의 효율적인 처리에만 관심이 있음
- OLAP : 의사결정에 도움이 되는 데이터 분석에만 관심이 있음.
- OLTP가 일상적인 기업의 운영을 지원하는 반면 OLAP는 기업의 방향을 설정하는 역할을 한다.
```

## 1. Transaction 각 유형(OLTP / DSS(= Batch = OLAP) / DTP의 정의, 특징, 사례를 찾으시오

은행의 업무 현황과 연관지어 자료를 정리하시오.

### OLTP

#### 정의

```
OLTP란 주 컴퓨터와 통신 회선으로 접속되어 있는 복수의 사용자 단말에서 발생한 트랜잭션을 
주 컴퓨터에서 처리하여 그 결과를 즉석에서 사용자 단말 측으로 되돌려 보내 주는 처리 형태를 말한다.
```

- OLTP 란 Oline Transaction Process(온라인 트랜잭션 처리)의 약자이다.

- OLTP란 여러과정(또는 연산)이 하나의 단위 프로세스로 실행되도록 하는 프로세스라고 할 수 있다.

- 즉, OLTP란 네트워크 상의 온라인 사용자들의 Database 에 대한 일괄 트랜잭션 처리를 의미한다. 

- 그래서 흔히 '트랜잭션(Transaction) 처리' 를 OLTP로 통용하기도 한다. 트랜잭션이라 부르는 용어의 의미 자체가 OLTP 의 의미를 포함하고 있다고 볼 수도 있다. 

- 출처: https://jins-dev.tistory.com/entry/간략하게-정리해보는-OLTP-OLAP-의-개념 [Jins' Dev Inside]

- 출처: https://splee75.tistory.com/75 [Study Log]

#### 특징

![image](https://user-images.githubusercontent.com/77392444/119741060-ef6f1e80-bebf-11eb-841e-215828a95a91.png)

- 트랜잭션의 주 특징이 그루핑된 연산의 실패시 Rollback 이 지원된다는 점인 것처럼, OLTP도 트랜잭션과 동일한 ACID 특징을 가진다.

- OLTP는 정보를 트랜잭션 단위로 수집하고, 분류 / 저장 / 유지보수 / 갱신 / 검색하는 기능을 수행한다.

- 기업에서 모든 트랜잭션 및 레코드를 저장하는 데 사용하는 데이터베이스를 OLTP(온라인 트랜잭션 처리) 데이터베이스라고 한다. 

- 일반적으로 이러한 데이터베이스의 레코드는 한 번에 하나씩 입력되고, 종종 이러한 데이터베이스는 조직에 귀중한 정보를 풍부하게 포함한다.

- 주로 OLTP(온라인 트랜잭션 처리) 데이터베이스를 DW(Data Warehouse)라 한다.

	- DW란? OLTP 시스템으로부터 필요한 데이터를 추출, 수정, 요약해서 의사결정을 지원할 수 있는 데이터베이스를 만든 것이다.

	- DW에 접근해 데이터를 분석하고 의사결정에 활용하는 방법이 OLAP라고 볼 수 있다.

- OLTP에 사용되는 데이터베이스는 분석용으로 적합하지 않다. OLTP 데이터베이스에서 답변을 검색할 때는 시간과 노력이 많이 든다. 
	- 테이블 및 열 이름을 포함하는 데이터베이스의 디자인을 사용자가 이해하기 어려울 수 있기 때문이다.
   	- 사용자는 쿼리할 테이블, 해당 테이블이 조인되는 방법, 올바른 결과를 얻기 위해 적용해야 하는 기타 비즈니스 논리를 알고 있어야 한다. 
    	- 또한 시작하기 위해 SQL과 같은 쿼리 언어를 알고 있어야 한다.
    
#### 사례

![image](https://user-images.githubusercontent.com/77392444/119741161-22191700-bec0-11eb-84c6-fcedc707fb04.png)


- OLTP 방식은 주로 하루에도 대량으로 처리되는 업무상의 트랜잭션을 처리하고 저장할 필요가 있는 경우에 사용한다. 

- 우리는 대부분의 활동을 스마트폰 하나로 해결할 수 있습니다. 은행에 가지 않아도 앱만 있으면 은행 업무를 할 수 있고, 몇 번의 터치만으로 다양한 물건을 구매할 수 있습니다. 모든 것을 온라인에서 해결합니다. 이 말을 바꿔 말하면, ‘온라인에 연결되지 않았다는 건 대부분의 경제활동에서 벗어났다’는 의미이기도 합니다.

- 우리가 온라인에서 무언가를 클릭(또는 터치)한다는 건 서버에 호출하는 행위이기도 합니다. 서버가 실시간으로 원하는 결과를 우리에게 다시 보내주는 것이죠. 이렇듯 많은 사람들에게 실시간으로 서버가 자료를 처리하는 과정을 OLPT(Online transaction processing)라고 합니다.


- OLTP는 흔히 '기간계'라고 부르며, 일반적으로 회사에서 기본적으로 사용하고 있는 ERP와 같은 시스템의 처리 방식이 OLTP이다.

	- 기간계 시스템이란? 은행의 계정계, 관공서의 주민등록원장과 같이 전체 시스템의 메인 데이터가 있는 시스템을 의미한다. 

- 항공사의 예약시스템, 은행의 창구업무시스템 등이 대표적인 OLTP 사례에 해당된다.

	- 이 시스템은 원시데이터가 실제로 발생하고 기록되는 시스템으로 무엇(what)에 초점을 맞추고 있다.

	- 이 시스템의 일차적인 목표는 현재 거래 상태를 정확하게 기록하고 갱신할 수 있도록 하는 것이다.

출처: https://itpassion.tistory.com/entry/현재-OLTPOnLine-Transaction-Processing란 [세상을 바꾸는 IT]

출처: https://jins-dev.tistory.com/entry/간략하게-정리해보는-OLTP-OLAP-의-개념 [Jins' Dev Inside]

#### 은행 사례

은행 9시 ~ 4시반 일어나는 작은 단위의 Transaction

**운영계** 

1. OLTP : Online Transaction Processing

2. 실시간 & 즉시처리하는 시스템.

3. 안정성과 정확성을 위주로 개발. 

- OLTP를 수행하는 시스템 및 부서를 운영계라고 한다. 

- 운영계는 주로 실시간 & 즉시처리하는 시스템이며, 안정성과 정확성을 위주로 개발한다.

- 운영을 담당하는 금융권 영업점에서 실시간으로 고객의 거래를 처리하기 위해 트랜잭션 단위로 발생하는 업무가 바로 OLTP 예시이다.


**계정계**

1. 고객의 거래를 처리하는 시스템

ex. 은행업무 (입금/출금...등등)

- 계정계란 고객의 거래를 처리하는 시스템이다.

- 은행의 전통적인 핵심 업무는 통장이 중심이 된다. 이 통장을 계좌, 계정이라고 한다. 그래서 계정을 관리하는 시스템이 모여있는 것을 계정계라고 부르며, 은행의 DW역할을 담당한다.

- 이 계정계 Dw의 정보를 트랜잭션 단위로 수집하고, 분류 / 저장 / 유지보수 / 갱신 / 검색하는 기능을 수행하는 것이 OLTP이다.

- 주로 고객의 통장 정보(계좌번호, 입출금, 이체, 펀드, 주식 등)와 관련된 업무가 계정계 OLTP의 사례이다. 

- 구체적으로 은행의 'ATM 현금 인출' 처리 과정을 OLTP의 사례로 들 수 있다.

```
<현금인출 OLTP>
과정 1 : 철수가 은행 ATM에서 계좌번호와 비밀번호를 입력 후, 현금 인출을 선택한다.
과정 2 : 철수의 계좌에서 50,000원을 감소시킨다. (계정계)
과정 3 : 현금을 인출해 준다.
과정 4 : 명세표를 출력해준다.
```

출처: https://propie.tistory.com/entry/기간계-정보계-운영계 [보안블로그]




### 2. DSS = OLAP = Batch

#### 정의

https://docs.microsoft.com/ko-kr/azure/architecture/data-guide/images/olap-data-pipeline.png

- OLAP(온라인 분석 처리)는 대규모 비즈니스 데이터베이스를 구성하고 복잡한 분석을 지원하는 기술이다. 

- OLAP는 트랜잭션 시스템에 부정적인 영향을 주지 않고 복잡한 분석 쿼리를 수행하는 데 사용할 수 있다.

- 분석DB는 OLAP, Batch처리위주시스템이다. 

- Batch processing 이란 작업을 몰아두었다가 한번에 처리하는 시스템이다.

- OLAP 처리를 위해서는 계정계(DW, OLTP 데이터)에서 데이터를 받아와야 하기 때문에, 실시간 처리가 아닌 주기적으로 Batch job, 스케쥴링을 통해 데이터를 업데이트 한다. 

- DSS (Decision Support System)는 의사결정 지원 시스템이다.

- DSS란 단순히 정보를 수집, 저장, 분배하기 위한 시스템을 넘어서 사용자들이 기업의 의사결정을 쉽게 내릴 수 있도록 사업 자료를 분석해주는 역할을 하는 컴퓨터 응용 프로그램이다.



#### 특징

- OLAP은 방대한 양의 데이터에 대해 집계 계산을 적용하는 데 특히 유용합니다. 

- OLAP 시스템은 분석 및 비즈니스 인텔리전스(BI) 등, 과도한 읽기 시나리오에 대해 최적화되어 있습니다. 

- OLAP는 다차원 데이터를 2차원으로 볼 수 있는 조각(예: 피벗 테이블)으로 분할하거나 데이터를 특정 값을 기준으로 필터링할 수 있도록 합니다. 

- OLAP 시스템은 고효율적 방식으로 데이터에서 이러한 비즈니스 인텔리전스(BI) 정보를 추출하는 데 도움이 되도록 디자인되었습니다. OLAP 데이터베이스가 과도한 읽기, 낮은 쓰기 워크로드에 최적화되어 있기 때문입니다.

- DSS는 각 부서별로 산발적으로 구축되어 통합적이지 못하고 다양한 시스템 상에 산재되어 존재하게 되어 활용을 거의 하지 않았다.

#### 사례

![image](https://user-images.githubusercontent.com/77392444/119741129-10377400-bec0-11eb-83e6-b7a73fafb42a.png)

- 조직의 데이터가 대형 데이터베이스에 저장되어 있습니다. 비즈니스 사용자 및 고객이 자체 보고서를 만들고 분석을 수행하는 데 이 데이터를 사용할 수 있게 하려고 합니다. 

- BI 프로그램들 (Azure 머신러닝, Power BI 등)

#### 은행 사례

집계, 통계 - 일괄 처리 ( 은행 4시반 이후 )

**정보계**

1. OLAP : Online Analysis Processing
2. 분석을 위한 목적. 경영자가 의사결정을 할 수 있게 도와주는 시스템. 
3. DM(Data Mart)나 DW(Data warehouse)등의 도구를 통해 사용된다

출처: https://propie.tistory.com/entry/기간계-정보계-운영계 [보안블로그]





### 3. DTP

#### 정의
- 분산 트랜잭션(Distributed Transaction)

- 하나의 데이터베이스 인스턴스 내에서 한 트랜잭션으로 묶인 SQL 문장이 모두 커밋되거나 롤백되듯이 네트워크로 연결된 여러 개의 데이터베이스 인스턴스가 참여하는 트랜잭션에서도 각각 다른 데이터베이스 인스턴스에서 수행한 SQL 문장이 모두 동시에 커밋되거나 롤백될 수 있는 방법이 필요하다.

- 이렇게 여러 개의 노드 또는 다른 종류의 데이터베이스가 참여하는 하나의 트랜잭션을 분산 트랜잭션이라고 한다. Tibero에서는 분산 트랜잭션을 처리하기 위해 XA와 데이터베이스 링크(DBLink)를 통해 지원한다.

https://technet.tmaxsoft.com/upload/download/online/tibero/pver-20131217-000019/tibero_admin/ch_07.html


 - 개념적으로는 하나의 트랜잭션과 동일한 개념이지만 실제로 서버가 분리 되어 잇다는 것만 차이가 있을 뿐이다. 


#### 특징

- 문법적으로는 BEGIN TRANSACTION 대신에 BEGIN DISTRIBUED TRANSACTION 을 사용하고 커밋은 똑같이 COMMIT TRANSACTION 이라 사용한다.

- 또 분산 트랜잭션이 시작되기 전에는 꼭  XACT_ABORT를 ON으로 설정해야 한다. 그렇게 되면 트랜잭션 중 어느 하나가 오류를 일으키면 전체 트랜잭션을 취소 한다.


- 분산 데이터베이스는 기본적으로 Replication과 Sharding을 지원한다.
	- Replication : 특정 DB 노드에 장애가 발생해도 다른 노드에 복제된 데이터가 존재, 부하 분산
	- Sharding : 데이터를 각 DB 노드에 나눠서 저장하여 안전성, 부하 분산
 
- 특징(CAP)
	- 일관성(Consistency) : 모든 요청은 최신 데이터 또는 에러를 응답 받음.
	- 가용성(Availability) : 모든 요청은 정상 응답을 받음.
	- 네트워크 파티션 허용(Partition tolerance) : 노드간 통신이 실패하는 경우라도 시스템은 정상 동작.

- 분산 시스템에서 3가지 속성을 모두 만족하는 것은 불가능하며, 오직 2가지만 만족할 수 있다.

	- CA : 일관성과 가용성을 동시에 완벽히 만족하려면, 네트워크 장애를 허용하지 않아야 한다.
 
	- CP : 완벽한 일관성을 갖는 분산 시스템에서 데이터 변경은 존재하는 모든 노느에 복제되어야 완료된다.
 
	- AP : 완벽한 가용성을 갖는 분산 시스템에서는 모든 노드가 어떤 상황에서도 응답할 수 있어야 한다.


#### 사례

#### 은행 사례

- 홍길동 계좌와 김철수 계좌가 같은 은행이라면(같은 시스템을 가진) 문제가 발생을 해도 원상 복구하는데 어려움이 없을껍니다. 하지만 서로 다른 은행이라면(다른 시스템을 가진) 좀 어려워 보이지 않나요? 분산트랜잭션은 논리적 또는 물리적으로 분산되어 있는 환경에서 하나의 작업으로 처리하는 것을 이야기 합니다.

- 만약 프로그램적으로 이러한 분산트랜잭션을 처리하도록 구현을 해야 한다면? 본인의 담당 시스템 뿐만 아니라 상대편 시스템도 신경써야 합니다. 이러한 은행이 수십개가 존재한다면? 더욱 어려울껍니다. 마이크로소프트에서 분산트랜잭션(Distributed Transaction)을 쉽게 관리하고 처리 할 수 있도록 만든것이 MSDTC(Microsoft Distributed Transaction Coordinator)입니다.

출처: https://www.dsun.kr/38 [Dsuny]

- 분산 트랜잭션의 예로 서로 다른 은행간의 거래를 들 수 있다. 

- 두 은행의 서버는 당연히 서로 독립적인 서버일 것이다. 

- 그런데 두 은행간의 계좌 이체의 경우는 출금과 입금이 한꺼번에 이루어 져야 한다. 

- 그래서 서버가 다르지만 하나의 트랜잭션으로 처리해야 하며 이를 분산 트랜잭션이라고 부르는 것이다.




## 5. Java : SQL Statement, Prepared Statement, Callable Statement

```
Transaction Type과 연계해서 정의, 장단점, 개발 시 차이점, 코딩 실습
```

- statement : 일반적인 sql쿼리를 실행

- preparedStatement : 동적 또는 매개변수가 필요한 sql쿼리를 실행
	- OLAP

- callableStatement : 저장된 프로시져를 실행
	- OLTP
	- 트랜잭션은 자바로 구현할수도 있고, 프로시저로 구현할 수도 있다.
    
https://daesuni.github.io/Java-statement-vs-preparedStatement-vs-callableStatement/
