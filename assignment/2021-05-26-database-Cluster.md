# Cluster, Clustering 개념, 목적, 구성사례

```
- WEB, WAS, DB의 관점에서
```

## Cluster, Clustering

### 개념

컴퓨터 클러스터란 여러 대의 컴퓨터들이 연결되어서 하나의 시스템처럼 동작하는 컴퓨터들의 집합을 말한다. 여러개의 객체를 하나로 모은다는 개념을 가지고 있다.

### 목적

클러스터는 일반적으로 단일 컴퓨터보다 더 뛰어난 성능과 안정성을 제공하며, 비슷한 성능과 안정성을 제공하는 단일 컴퓨터보다 비용 면에서 훨씬 더 효율적이다.

## Web Server, WAS Server : Session Cluster

- 세션 클러스터링이란?

두 대 이상의 WAS를 이용하는 경우 로드 밸런싱(대용량 트래픽 처리시 분산시키는 것) 또는 failover(장애 발생시 예비시스템으로 자동전환, 서버 이중화), auto scaling(AWS에서 EC2 인스턴스를 자동으로 생성하고 삭제해주는 서비스) 등의 대체된 WAS에게도 세션이 공유하게 하는 기술 입니다.


- 세션 클러트서링 구성 방식

![image](https://user-images.githubusercontent.com/77392444/119743723-770b5c00-bec5-11eb-8cd8-0266628f532f.png)

1) WAS 간 구성
세션 데이터별 Primary/BackUp 인스턴스를 지정하여 공유합니다.
장점: 별도의 서버 인프라 없이 가능합니다.
단점: 세션데이터의 백업 및 동기화 이슈, 장애 발생시 세션 복제의 이슈가 발생

2) 세션 Server 구성
별도의 세션 서버 운영합니다.
장점: 인스턴스간 세션 공유 설정이 용이합니다. 
단점: 단일 장애 지점으로 장애시 복제를 구성해야 합니다. 성능이 좋지 못합니다.

3) 세션 데이터그리드 구성
데이터그리드(JVM 프로세스 수를 늘리는것)에서 세션 정보를 저장하여 운영합니다.
장점: 인스턴스와 애플리케이션 간 세션 공유가 용이합니다. Elastic 확장성과 안장성을 보장합니다. 메모리 기반 고성능.
단점: 별도의 서버 구성으로 인한 비용 발생합니다, 관리포인트가 증가합니다. 
예시: Tomcat , JBoss , WebLogic 

https://junshock5.tistory.com/91


## DB Server : Cluster

- DB 클러스터도 컴퓨터 클러스터와 똑같은 맥락이다. DB 서버를 여러개 둔다고 생각하면 된다. 이에 대한 기본적인 장점은 서버 한 대가 죽어도 대비가 가능하다는 점이다.

- DB 클러스터와 비슷한 형태로 복수개의 독립된 DB가 서로 연계되는 경우가 있다. 이 DB는 서로 데이터를 읽거나 쓰는데, DBLink 또는 SQL/MED라고 한다.

- DB가 제공하는 기능중에서, 하나의 서버만으로 실현이 힘든 기능은 아래의 3가지이다.

  - 고가용성(Transactional)
  - 병렬처리(Analytic)
  - 성능향상(Online)

- 이러한 분류 방법은 오픈소스 관계형 DB시스템(RDBMS)의 하나인 Postgres의 코어 멤버인 Josh Berkus씨가 제안한 것이다. 현재 PostgreSQL을 사용한 클러스터 기술의 의론의 기반이 되고 있다.

- 고가용성(Transactional)

  - 무언가의 원인으로 DB가 충돌을 일으킨 경우라도, 단시간내에 실행을 재개가능할 뿐 아니라 데이터의 내용도 유실되지 않도록 하지 않으면 안되는 경우가 상황이 있다.
  - DB의 가용성이란, DB가 동작하고 있는 시간과 정지한 시간의 비율이다. 즉 99.9%또는 99.99%와 같이 표현한다. 
  - 가용성 99.99%란 연간 53분간 장애로 정지했음을 의미한다. 99.999%의 가용성이란 5분 정도 정지했음을 의미한다. 
  - 서버가 한대인 경우에 장애가 발생하면 미리 백업해 둔 데이터를 복원하고, 백업할 시점으로 부터 장애발생까지의 사이의 갱신로그(트랜젝션 로그)를 적용해서 복구해야 한다. 
  - 백업만으로는 백업한 이후에 발생한 변경을 날려 버리기 때문에 로그 등을 이용해서 복구해줄 필요가 있는 것이다.
  - 서버가 하드웨어적인 장애로 충돌한 경우, 새로운 서버로 교체한 후, 데이터베이스를 복원하고, 변경을 적용하게 된다. 이런 경우 소프트웨어 장애로 발생한 충돌에 비해 복구에 많은 시간이 걸리게 되어 수일까지 걸릴 수 있다. 이는 DB 운영에서 있을 수 없는 일이다.
  - 고가용성을 실형하려면 머저, DB 시스템을 구성할 서버나 스토레지 장비를 각각 2대 이상으로 구성해서, 만의 하나 어느쪽인가에 장애가 발생했다고 하더라도 단 시간내에 운용을 재개할 수 있도록 함을 의미한다. 이를 고가용성 클러스터라고 한다.
  - 고가용성 클러스터 구축시의 주의점은 어딘가 하 부분의 문제가 발생했을 때 복구하는데까지 오랜 시간이 걸리지 않도록 해야 한다는 점이다. 한 부분의 문제가 전체 시스템을 정지 시켜 버리는 곳을 Single Point Of Failure, SPOF라고 한다.

- 병렬처리(Analytic)
  - 데이터웨어하우스(DWH)를 정보원으로 하는 데이터 분석 어플리케이션(BI툴 등)과 같이, 데이터베이스의 내용을 분석하는데 사용하는 어플리케이션이 있다. 
  - 이런 경우 분석 대상의 데이터량이 너무 많고(수 기가, 테라 바이트), 사용하는 SQL문이 복잡(10개 이상의 테이블의 조합을 해서 통계를 내거나)하기 때문에 하나의 SQL문 실행에 막대한 시간이 걸린다. 
  - 이럴 경우 데이터베이스를 복수 개의 작은 단위로 분해해서 각각을 분석하는 처리를 병렬로 실행해서 결과를 통합하는 것 같은 방법을 사용할 수 있다.

- 성능향상(Online)
  - DB 유저수가 막대해 지는 케이스는, Web계 어플리케이션에서 자주 발생하는 케이스이다. 
  - 대규모 Web 어플리케이션의 경우 데이터베이스의 복사본을 만들어서 참조 처리는 복사한 DB를 사용하게 하는 방법으로 유저수가 많아지는 것을 대비할 수 있다.

- 이런식으로 복수개의 서버를 조합해서 위의 3가지 요구를 만족시키는 시스템의 구성형태를 DB 클러스터라고 한다.

http://hanbiro.net/img/tech/db_clus02.gif

- Master-Server 두대가 동일하게 작동하므로 서버중 한대가 Fail시 나머지 서버가 계속해서 임무 수행 

- 각 서버에 동일한 데이터가 저장되므로 어플리케이션 접근에 의한 부하를 분산시킬 수 있습니다.

http://hanbiro.net/img/tech/db_clus03.gif

- Master-Server 중 한대는 Primary Server로서 기능을 하다가 Fail시 Standby Server가 임무를 수행 
데이터 입력(Insert,Update, Delete)은 모두 마스터 서버에서 이루어지고, 데이터 불러오기(Select)는 슬레이브 서버들이 담당하게 되어 Select 쿼리가 많은 사이트에서 최적의 성능을 발휘할 수 있습니다.

- 실시간으로 데이터 복제가 가능하며, 서버에 거의 영향을 주지 않습니다.


