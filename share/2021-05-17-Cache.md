# 캐시


## CPU와 캐시
- CPU가 하는 일 : 연산(산술연산/논리연산), 저장, 제어
- CPU는 데이터를 가져다가 연산을 하는데, 가장 가까운 데이터가 Register이고, L1 Cache, L2, L3, Main Memory, SSD/HDD 순으로 CPU와 가깝다. 

- CPU : Memory보다 100배 빠름(느린 Memory보다 CPU에 더 가까운 공간에 데이터를 저장해두고 사용하면 더 빠르다.)
- Memory : DISK보다 100배 빠름
- DISK

## CPU와 Core

![image](https://user-images.githubusercontent.com/77392444/119298323-c4a28180-bc97-11eb-9dda-8e1a2b5e5aca.png)


- Core : 각종 연산을 하는 CPU의 핵심 요소이다. 

- CPU가 뇌라면, Core는 CPU 안에서 연산일을 하는 부품으로 볼 수 있다. 

- Core가 여러개이면 연산을 동시에 여러번 수행할 수 있게 된다. 

- 2CPU에 28Core라면, 1CPU당 28Core를 가진다는 것이다. 즉, 총 56Core가 있어서 56Thread를 처리할 수 있다는 것이다. (Paralle processing)

## 프로세스 vs Thread 

- 프로그램 : 작업을 위해 실행할 수 있는 파일

- 프로세스 : 컴퓨터에서 메모리에 적재되어 실행되고 있는 프로그램


### 프로세스


![image](https://user-images.githubusercontent.com/77392444/119298785-abe69b80-bc98-11eb-836e-7a69e43d1498.png)

- 프로세스가 할당받는 시스템 자원

  - STACK  :  함수에서 다른 함수를 실행하는 등의 서브루틴들 정보저장

  - CODE : 프로그래밍 코드 텍스트가 들어가는 메모리 영역 ( 컴파일 결과물) 

  - DATA : BSS ( 초기화 되지 않은 전역변수 ) , DATA ( 초기 값이 있는 전역변수 )

  - HEAP : 동적 메모리 할당,  코드에서 동적으로 만들어지는 데이터

- 프로세스의 특징

  - 기본적으로 프로세스당 최소 1개의 스레드를 가지고 있음

  - 각 프로세스는 별도의 주소 공간에서 실행,  다른 프로세스 접근 X

  - 다른 프로세스 자원에 접근하려면 IPC(파이프, 파일 소켓 등)을 사용


### 스레드(Thread)


![image](https://user-images.githubusercontent.com/77392444/119299005-1b5c8b00-bc99-11eb-95ee-3c496ca9f25c.png)

- 쓰레드란?

  - 프로세스 내에서 실행되는 여러 흐름의 실행 단위

  - 프로세스가 할당 받은 자원을 이용하는 실행 흐름의 단위

  - 즉, 사용자가 사용할 일꾼의 손 갯수라고 볼 수 있다. 

- Thread 특징

  - 메모리를 서로 공유 가능하다.

  - 하나의 실행중인 프로세스 안에 여러 개의 태스킹을 동시에 사용하고 싶을 때, 사용

- Stack을 독립적으로 가지는 이유

  - 스택은 함수 호출 시 전달되는 인자, 작업 후 되돌아갈 주소값 및 함수 내에서 선언

  - 독립적은 함수를 호출이 가능 -> 독립적인 실행 흐름




![image](https://user-images.githubusercontent.com/77392444/119299131-5068dd80-bc99-11eb-8911-5b21b165d0fc.png)

- 컴퓨터 입장에서는 프로세스보다 쓰레드가 더 가볍다. 왜일까?

  - 쓰레드는 code, data, heap 영역은 한 번만 받고, stack만 여러개 받으면 되기 때문이다. 



## Web Server / WAS / DB 에서의 캐시

![image](https://user-images.githubusercontent.com/77392444/119299518-046a6880-bc9a-11eb-86e9-d2e1548cec3f.png)

- Browser Cache

  - 클라이언트 내부 저장소에 웹페이지를 탐색할 때 다운로드 한 데이터 저장

  - 브라우저 속도를 높임 


- Response Cache
  - 웹 서버는 Application Host로 동일한 요청이 전송되지 않도록 제어

  - 비용이 높은 DB쿼리나 자주 요청되는 파일들을 캐시 처리



- DATABASE Cache

  - 처음 쿼리를 전송할 때는 데이터베이스에서 직접 가져옴

  - 두 번째 쿼리부터는 캐시에 저장된 데이터를 가져와 직접 쿼리 전송 X

- DISK Cache
  - 요청에 의해서 하드 디스크 파일 시스템에 있는 정적 리소스 제공

  - 하드 디스크는 캐시 처리를 통해 성능 개선
 
- Application Cache

  - 모든 사용자들이 자주 요청할만한 웹페이지나 파일 등을 저장

  - 클라이언트가 해당 데이터를 요청할 때 빠르게 응답

  - 서버에서 많이 쓰일 것이라고 예상되는 데이터들을 캐시 처리


## Cache 용어
- Cache HIT : CPU가 요청한 데이터가 캐시에 존재 or Memory가 요청한 데이터가 캐시에 존재
- Cache Miss : 캐시에 존재X , Memory에서 가져오는 경우 or DISK에서 가져오는 경우


## 스칼라 서브쿼리
스칼라 서브쿼리 중에 서브쿼리가 메인쿼리의 컬럼을 참조하는 경우, 
일반적으로 서브쿼리가 먼저 실행되어서 상수 결과값을 뱉어내는데, 상수값을 치환한 다음 메인쿼리가 실행된다.
근데, 서브쿼리와 메인쿼리가 상호 연동 적으로 실행되는 경우 서브쿼리와 메인쿼리가 여러번 실행된다.
실행순서는 서브쿼리가 먼저 실행 -> 메인쿼리가 후에 수행되는 것이 일반적인데, 
메인쿼리가 먼저 실행되고 후에 서브쿼리가 여러번 실행된다. 

- 해시와 캐시
  - 스칼라 서브쿼리는 최소한만 실행되어 값을 해시 테이블에 저장해둔다. 그래서 서브쿼리를 반복해서 여러번 수행하지 않고 최소한만 수행할 수 있게 되는 것이다. 
